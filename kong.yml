_format_version: "2.1"

services:
  - host: alarms_upstream
    name: alarms_service
    protocol: http
    routes:
      - name: alarms
        paths:
          - /alarms
          - /alarmsValidate/
        strip_path: false
    
upstreams:
  - name: alarms_upstream
    targets:
      - target: <ip-privada-alarms-app-a>:8080
        weight: 100
      - target: <ip-privada-alarms-app-b>:8080
        weight: 100
    healthchecks:
      threshold: 50  # El servicio se considera en fallo si menos del 50% de las instancias están sanas
      active:
        http_path: /health/
        timeout: 1
        healthy:
          successes: 3   # Se considera saludable después de 3 respuestas exitosas
          interval: 5    # Intervalo de 5 segundos entre health checks cuando está sano
        unhealthy:
          tcp_failures: 1   # Una falla de TCP marca la instancia como no saludable
          interval: 5       # Intervalo de 5 segundos entre health checks cuando está en fallo
